// @flow
import type { DetailedBatchItem, ExternBatchItemForm } from 'modules/batch/type.js.flow';

export type File = {
  id: string,
  path: string,
  type: string,
  memo: ?string,
};

export type Tag = {
  id: string,
  name: string,
  description: ?string,
  color: string,
};

export type User = {
  id: string,
  firstName: string,
  lastName: string,
  email: string,
  role: string,
  tags: Array<Tag>,
  createdAt: string,
  updatedAt: string,
};

export type Event = {
  id: string,
  type: string,
  target: Object & {
    __typename: string,
  },
  changes: Array<{
    field: string,
    oldValue: any,
    newValue: any,
  }>,
  user: User,
  createdAt: string,
  updatedAt: string,
};

export type Comment = {
  id: string,
  body: string,
  user: User,
  createdAt: string,
  updatedAt: string,
};

export type Entry = (Comment | Event) & { __typename: string };

export type Timeline = Array<Entry>;

export type Warehouse = {
  id: string,
  name: string,
  locality: ?string,
  region: ?string,
};

export type TimelineActualDate = {
  id?: string,
  date: ?string,
  type: string,
  memo?: ?string,
  createdAt: string,
  updatedAt: string,
  updatedBy: ?User,
};

export type TimelineDate = {
  estimatedDate: ?string,
  approvedAt: ?string,
  actualDates: Array<TimelineActualDate>,
  approvedBy: ?User,
  assignedTo: Array<User>,
};

export type DetailedShipmentVoyage = {
  id: string,
  departureDate: TimelineDate,
  arrivalDate: TimelineDate,
  departurePort: ?string,
  arrivalPort: ?string,
  voyageCode: ?string,
  vesselName: ?string,
};

export type DetailedShipmentContainerGroup = {
  warehouse: ?Warehouse,
  customClearanceDate: TimelineDate,
  warehouseArrivalDate: TimelineDate,
  deliveryReadyDate: TimelineDate,
};

export type DetailedShipment = {
  id: string,
  status: string,
  currentStatus: string,
  nextStatus: ?string,
  carrier: ?string,
  BL: ?string,
  BLDate: ?string,
  no: string,
  bookingNo: ?string,
  bookingDate: ?string,
  invoiceNo: ?string,
  incoterms: ?string,
  loadType: ?string,
  transportType: ?string,
  containerType: ?{
    code: string,
    description: string,
    length: string,
    height: string,
  },
  cargoReadyDate: TimelineDate,
  freightCost: number,
  inlandExporterCost: ?number,
  inlandImporterCost: ?number,
  documentFee: ?number,
  deliveryOrderFee: ?number,
  exporterMiscFee: ?number,
  importerMiscFee: ?number,
  tariffTax: ?number,
  consumptionTax: ?number,
  exporterCurrency: ?string,
  importerCurrency: ?string,
  firstExchangeRate: number,
  secondExchangeRate: number,
  ratio: number,
  memo: ?string,
  createdAt: string,
  updatedAt: string,
  group: {
    name: string,
  },
  exporter: {
    id: string,
    name: string,
  },
  forwarders: Array<{
    id: string,
    name: string,
  }>,
  tags: Array<Tag>,
  batchItems: Array<DetailedBatchItem>,
  voyages: Array<DetailedShipmentVoyage>,
  containerGroups: Array<DetailedShipmentContainerGroup>,
  files: Array<File>,
  timeline: Timeline,
};

export type ShipmentTimeline = {
  exporter: { name: string },
  transportType: ?string,
  cargoReadyDate: TimelineDate,
  voyages: Array<DetailedShipmentVoyage>,
  containerGroups: Array<DetailedShipmentContainerGroup>,
};

export type Shipment = {
  id: string,
  no: string,
  BL: string,
  exporter: {
    id: string,
    name: string,
  },
  tags: Array<Tag>,
  batchItems: Array<{ id: string }>,
} & ShipmentTimeline;

// Form types
export type ShipmentVoyageForm = {
  id: string,
  vesselName?: ?string,
  voyageCode?: ?string,
  departureDate: TimelineDate,
  arrivalDate: TimelineDate,
  departurePort?: ?string,
  arrivalPort?: ?string,
};

export type ShipmentContainerGroupForm = {
  warehouse: ?Warehouse,
  customClearanceDate: TimelineDate,
  warehouseArrivalDate: TimelineDate,
  deliveryReadyDate: TimelineDate,
};

export type ShipmentForm = {
  no: string,
  status?: string,
  BL: ?string,
  BLDate: ?string,
  bookingNo: ?string,
  bookingDate: ?string,
  carrier: ?string,
  loadType: ?string,
  transportType: ?string,
  containerType: ?string,
  cargoReadyDate: TimelineDate,
  freightCost: ?number,
  inlandExporterCost: ?number,
  inlandImporterCost: ?number,
  documentFee: ?number,
  deliveryOrderFee: ?number,
  exporterMiscFee: ?number,
  importerMiscFee: ?number,
  tariffTax: ?number,
  consumptionTax: ?number,
  exporterCurrency: ?string,
  importerCurrency: ?string,
  firstExchangeRate: ?number,
  secondExchangeRate: ?number,
  ratio: ?number,
  memo?: ?string,
  exporterId: string,
  forwarderIds: Array<string>,
  tags: Array<Tag>,
  batchItems: Array<ExternBatchItemForm>,
  voyages: Array<ShipmentVoyageForm>,
  containerGroups: Array<ShipmentContainerGroupForm>,
};

export type ShipmentTimelineForm = {
  transportType: ?string,
  cargoReadyDate: TimelineDate,
  voyages: Array<ShipmentVoyageForm>,
  containerGroups: Array<ShipmentContainerGroupForm>,
};
