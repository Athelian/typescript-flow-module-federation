// @flow
import type { SelectableOrderItem } from 'modules/order/type.js.flow';

export type DateRange = {
  after: ?Date | ?string,
  before: ?Date | ?string,
};

export type Tag = {
  id: string,
  name: string,
  description: ?string,
  color: string,
};

export type User = {
  id: string,
  firstName: string,
  lastName: string,
  email: string,
  role: string,
  tags: Array<Tag>,
  createdAt: string,
  updatedAt: string,
};

export type Filter = {
  query?: ?string,
  supplierId?: ?string,
  exporterId?: ?string,
  user?: ?string,
  hasShipment?: ?boolean,
  excludeHasShipment?: Array<string>,
  hasBatchGroup?: ?boolean,
  excludeHasBatchGroup?: Array<string>,
  usable?: ?boolean,
  deliveredAt?: ?DateRange,
  expiredAt?: ?DateRange,
  producedAt?: ?DateRange,
  tags?: ?Array<Tag>,
};

export type BatchItemAdjustment = {
  id: string,
  type: string,
  quantity: number,
  memo: ?string,
};

export type BatchItemAssignment = {
  id: string,
  quantity: number,
  user: User,
  request: ?{
    id: string,
    client: ?string,
    quantity: number,
  },
  memo: ?string,
};

// BatchItemCard
export type BatchItem = {
  id: string,
  createdAt: string,
  updatedAt: string,
  no: string,
  quantity: number,
  realQuantity: number,
  deliveredAt: ?string,
  tags: Array<Tag>,
  adjustments: Array<BatchItemAdjustment>,
  assignments: Array<BatchItemAssignment>,
  batchGroup: ?{
    id: string,
    no: string,
    taskManagement: ?{
      id: string,
      lastApprovedTask: ?{
        id: string,
        icon: string,
        title: string,
        approvedAt: ?string,
        approvedBy: ?User,
      },
    },
  },
  shipment: ?{
    id: string,
    no: ?string,
  },
  orderItem: {
    id: string,
    order: {
      id: string,
      PO: string,
      exporter: {
        id: string,
        name: string,
      },
    },
    productExporterSupplier: {
      id: string,
      product: {
        id: string,
        name: string,
        serial: string,
        files: Array<{
          path: string,
        }>,
      },
    },
  },
};

export type DetailedBatchItem = {
  id: string,
  status: string,
  no: string,
  quantity: ?number,
  realQuantity: number,
  unassignedQuantity: number,
  producedAt: ?Date,
  deliveredAt: ?Date,
  expiredAt: ?Date,
  packageQuantity: ?number,
  packageName: ?string,
  packageGrossWeight: ?number,
  packageVolume: ?number,
  packageMaxQuantity: ?number,
  packageSize: ?string,
  memo: ?string,
  createdAt: string,
  updatedAt: string,
  orderItem: {
    id: string,
    price: number,
    order: {
      id: string,
      PO: string,
      currency: string,
      exporter: {
        id: string,
      },
    },
    productExporterSupplier: {
      id: string,
      inspectionFee: ?number,
      weight: ?number,
      volume: ?number,
      exporter: {
        id: string,
        name: string,
      },
      product: {
        id: string,
        name: string,
        serial: string,
        files: Array<File>,
      },
    },
  },
  tags: Array<Tag>,
  assignments: Array<BatchItemAssignment>,
  adjustments: Array<BatchItemAdjustment>,
  shipment: ?{
    id: string,
    no: ?string,
    currentStatus: string,
  },
  batchGroup: ?{
    id: string,
    no: string,
  },
};

export type BatchItemAdjustmentForm = {
  id?: ?string,
  type?: string,
  quantity?: number,
  memo?: ?string,
};

export type BatchItemAssignmentForm = {
  id?: ?string,
  user: User,
  request: ?{
    id: string,
    client: ?string,
    quantity: number,
  },
  quantity?: number,
  memo?: ?string,
};

export type BatchItemForm = {
  id?: ?string,
  hasShipment?: boolean,
  hasBatchGroup?: boolean,
  status: string,
  no?: string,
  quantity?: number,
  expiredAt?: ?Date,
  deliveredAt?: ?Date,
  producedAt?: ?Date,
  packageQuantity?: ?number,
  packageMaxQuantity?: ?number,
  packageGrossWeight?: ?number,
  packageVolume?: ?number,
  packageSize?: ?string,
  assignments: Array<BatchItemAssignmentForm>,
  adjustments: Array<BatchItemAdjustmentForm>,
  tags: Array<Tag>,
  memo?: ?string,
};

export type ExternBatchItemForm = {
  isNew: boolean,
  batchItem?: ?DetailedBatchItem,
  orderItem?: ?SelectableOrderItem,
  status: string,
  no?: string,
  quantity?: ?number,
  expiredAt?: ?string,
  deliveredAt?: ?string,
  producedAt?: ?string,
  packageQuantity?: ?number,
  packageMaxQuantity?: ?number,
  packageGrossWeight?: ?number,
  packageVolume?: ?number,
  packageSize?: ?string,
  assignments: Array<BatchItemAssignmentForm>,
  adjustments: Array<BatchItemAdjustmentForm>,
  tags: Array<Tag>,
  memo?: ?string,
};
